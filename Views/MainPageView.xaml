<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
	x:Class="WorkLog.Views.MainPageView"
	xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
	xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
	xmlns:converters="clr-namespace:WorkLog.Converters"
	xmlns:models="clr-namespace:WorkLog.Models"
	xmlns:vm="clr-namespace:WorkLog.ViewModels"
	x:DataType="vm:MainPageViewModel"
	BackgroundColor="{AppThemeBinding Light=#F9F9F9,
	                                  Dark=#1C1C1E}"
	Shell.NavBarIsVisible="False">

	<ContentPage.Resources>
		<converters:EnumToDescriptionConverter x:Key="EnumDescriptionConverter" />
		<converters:DateTimeToHumanizedStringConverter x:Key="HumanDateConverter" />
		<converters:IsNotNullOrEmptyConverter x:Key="IsNotNullOrEmptyConverter" />
	</ContentPage.Resources>

	<Grid ColumnDefinitions="*, 3*">
		<Grid
			Grid.Column="0"
			Padding="15"
			BackgroundColor="{AppThemeBinding Light=White,
			                                  Dark=#2C2C2C}"
			RowDefinitions="Auto, Auto, *"
			RowSpacing="10">
			<Grid Grid.Row="0" ColumnDefinitions="*, Auto">
				<Label
					FontAttributes="Bold"
					FontSize="Title"
					Text="事件流"
					VerticalOptions="Center" />
				<Button
					Grid.Row="0"
					Grid.Column="1"
					Command="{Binding ClearFormCommand}"
					CornerRadius="8"
					HorizontalOptions="End"
					Style="{StaticResource ScaleOnPressButtonStyle}"
					Text="+ 新建日志" />
			</Grid>

			<SearchBar
				Grid.Row="1"
				Placeholder="搜索日志描述或标签..."
				Text="{Binding SearchText}" />

			<CollectionView
				Grid.Row="2"
				ItemsSource="{Binding Events}"
				SelectedItem="{Binding SelectedEvent}"
				SelectionMode="Single">
				<CollectionView.ItemsLayout>
					<LinearItemsLayout ItemSpacing="5" Orientation="Vertical" />
				</CollectionView.ItemsLayout>

				<CollectionView.EmptyView>
					<StackLayout
						Padding="30"
						HorizontalOptions="Center"
						Spacing="5"
						VerticalOptions="Center">
						<Label
							FontFamily="FluentIcons"
							FontSize="48"
							HorizontalOptions="Center"
							Text="&#xE783;"
							TextColor="{StaticResource Gray300}" />

						<Label
							FontAttributes="Bold"
							FontSize="16"
							HorizontalOptions="Center"
							Text="{Binding EmptyViewTitle}"
							TextColor="{StaticResource Gray500}" />

						<Label
							FontSize="14"
							HorizontalOptions="Center"
							Text="{Binding EmptyViewSubtitle}"
							TextColor="{StaticResource Gray400}" />
					</StackLayout>
				</CollectionView.EmptyView>

				<CollectionView.ItemTemplate>
					<DataTemplate x:DataType="models:WorkEvent">
						<Border
							Padding="15"
							Stroke="{AppThemeBinding Light=#E0E0E0,
							                         Dark=#404040}"
							StrokeThickness="1">
							<Border.StrokeShape>
								<RoundRectangle CornerRadius="8" />
							</Border.StrokeShape>

							<Border.Shadow>
								<Shadow
									Brush="Black"
									Opacity="0.2"
									Radius="10"
									Offset="5,5" />
							</Border.Shadow>

							<VerticalStackLayout Spacing="8">
								<Label
									FontAttributes="Bold"
									LineBreakMode="TailTruncation"
									MaxLines="3"
									Text="{Binding Title, Mode=OneWay}" />

								<Grid
									ColumnDefinitions="Auto, Auto, Auto, *, Auto"
									ColumnSpacing="10"
									VerticalOptions="Center">
									<Label
										Grid.Column="0"
										FontSize="Caption"
										Text="{Binding EventType, Converter={StaticResource EnumDescriptionConverter}, Mode=OneWay}"
										TextColor="{StaticResource Primary}" />

									<BoxView
										Grid.Column="1"
										Margin="0,2"
										VerticalOptions="Fill"
										WidthRequest="1"
										Color="{StaticResource Gray300}" />

									<Label
										Grid.Column="2"
										FontSize="Caption"
										Text="{Binding Status, Converter={StaticResource EnumDescriptionConverter}, Mode=OneWay}"
										TextColor="{StaticResource Primary}" />

									<Label
										Grid.Column="4"
										FontSize="Caption"
										HorizontalOptions="End"
										Text="{Binding Timestamp, Converter={StaticResource HumanDateConverter}, Mode=OneWay}"
										TextColor="{StaticResource Gray500}" />
								</Grid>
							</VerticalStackLayout>

							<VisualStateManager.VisualStateGroups>
								<VisualStateGroup x:Name="CommonStates">
									<VisualState x:Name="Normal" />
									<VisualState x:Name="Selected">
										<VisualState.Setters>
											<Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#E8E8FF, Dark=#3A3A5A}" />
										</VisualState.Setters>
									</VisualState>
								</VisualStateGroup>
							</VisualStateManager.VisualStateGroups>
						</Border>
					</DataTemplate>
				</CollectionView.ItemTemplate>
			</CollectionView>
		</Grid>

		<Grid Grid.Column="1" RowDefinitions="*, Auto">
			<ScrollView Grid.Row="0">
				<VerticalStackLayout Padding="25" Spacing="20">
					<Grid ColumnDefinitions="*, Auto" VerticalOptions="Center">
						<Label
							Grid.Column="0"
							FontAttributes="Bold"
							FontSize="Title"
							Text="编辑日志" />
						<Label
							Grid.Column="1"
							Margin="0,0,0,2"
							FontSize="Micro"
							IsVisible="{Binding LastModifiedText, Converter={StaticResource IsNotNullOrEmptyConverter}}"
							Text="{Binding LastModifiedText}"
							TextColor="{StaticResource Gray500}"
							VerticalOptions="End" />
					</Grid>
					<VerticalStackLayout Spacing="5">
						<Label FontAttributes="Bold" Text="标题" />
						<Entry
							FontFamily="MapleMono"
							FontSize="Micro"
							Placeholder="一句话概括日志内容..."
							Text="{Binding TitleText}" />
					</VerticalStackLayout>

					<VerticalStackLayout Spacing="5">
						<Label FontAttributes="Bold" Text="事件描述" />
						<Editor
							FontFamily="MapleMono"
							FontSize="Micro"
							HeightRequest="350"
							IsSpellCheckEnabled="False"
							Placeholder="在这里详细记录事件..."
							Text="{Binding DescriptionText}" />
					</VerticalStackLayout>

					<VerticalStackLayout Spacing="5">
						<Label FontAttributes="Bold" Text="备注" />
						<Editor
							FontFamily="MapleMono"
							FontSize="Micro"
							HeightRequest="100"
							IsSpellCheckEnabled="False"
							Placeholder="输入可选的备注信息..."
							Text="{Binding RemarksText}" />
					</VerticalStackLayout>

					<Grid
						ColumnDefinitions="*, *, *"
						ColumnSpacing="15"
						RowSpacing="10"
						VerticalOptions="Center">

						<HorizontalStackLayout
							Grid.Column="0"
							HorizontalOptions="Center"
							Spacing="10"
							VerticalOptions="Center">
							<Label
								FontAttributes="Bold"
								FontSize="Micro"
								Text="日期:"
								VerticalOptions="Center" />
							<DatePicker
								Date="{Binding SelectedDate}"
								FontSize="Micro"
								VerticalOptions="Center" />
						</HorizontalStackLayout>

						<Grid
							Grid.Column="1"
							ColumnDefinitions="Auto, *"
							ColumnSpacing="10"
							HorizontalOptions="Center">
							<Label
								Grid.Column="0"
								FontAttributes="Bold"
								FontSize="Micro"
								Text="定位:"
								VerticalOptions="Center" />
							<Picker
								Grid.Column="1"
								FontSize="Micro"
								ItemDisplayBinding="{Binding ., Converter={StaticResource EnumDescriptionConverter}}"
								ItemsSource="{Binding EventTypes}"
								SelectedItem="{Binding SelectedEventType}" />
						</Grid>

						<Grid
							Grid.Column="2"
							ColumnDefinitions="Auto, *"
							ColumnSpacing="10"
							HorizontalOptions="Center">
							<Label
								Grid.Column="0"
								FontAttributes="Bold"
								FontSize="Micro"
								Text="状态:"
								VerticalOptions="Center" />
							<Picker
								Grid.Column="1"
								FontSize="Micro"
								ItemDisplayBinding="{Binding ., Converter={StaticResource EnumDescriptionConverter}}"
								ItemsSource="{Binding Statuses}"
								SelectedItem="{Binding SelectedStatus}" />
						</Grid>
					</Grid>
				</VerticalStackLayout>
			</ScrollView>

			<Grid
				Grid.Row="1"
				Padding="25"
				ColumnDefinitions="*, *, *"
				VerticalOptions="End">
				<Button
					Grid.Column="0"
					BackgroundColor="{StaticResource Dangerous}"
					Command="{Binding DeleteCommand}"
					HorizontalOptions="Start"
					Style="{StaticResource DangerButtonStyle}"
					Text="删除"
					TextColor="White" />

				<Button
					Grid.Column="1"
					Command="{Binding CopyCommand}"
					HorizontalOptions="Center"
					Style="{StaticResource CopyButtonStyle}"
					Text="{Binding CopyButtonText}" />

				<Button
					Grid.Column="2"
					BackgroundColor="{StaticResource Primary}"
					Command="{Binding SaveCommand}"
					FontAttributes="Bold"
					HorizontalOptions="End"
					Style="{StaticResource SaveButtonStyle}"
					Text="{Binding SaveButtonText}"
					TextColor="White" />
			</Grid>
		</Grid>
	</Grid>
</ContentPage>
